{% extends '@Discount/base.html.twig' %}
{% block title %}Popular shop{% endblock %}

{% block body %}
    <style>
        table {
            border: red 1px solid;
            margin: 15px 30px;
            padding: 15px;
        }
        td {
            padding: 10px;
        }
    </style>

    <div class="shell">
        <div class="gallery">



            {% if errors|length > 0 %}
                <ul>
                    {% for error in errors %}
                        <li style="color: red">{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}




            <form method="get" action="{{ path('popular_shop_groups_add') }}">
                <table>
                    <tr>
                        <td>
                            <label>ID Категории</label>
                            <input type="number" name="newCatId" value="">
                        </td>
                        <td>
                            <label>ID магазинов</label>
                            <input type="text" name="newShopId" value="">
                        </td>
                        <td>
                            <input type="hidden" name="groupId" value="0">
                            <input type="submit" value="Добавить">
                        </td>
                    </tr>
                </table>
            </form>

            <form method="get" action="{{ path('popular_shop_groups_edit') }}">
                <table>
                    <th>ID категории</th>
                    <th>ID магазинов</th>
                    <th>Действия</th>

                    {% for popularShopGroup in popularShopGroups %}
                        {% set sort = popularShopGroup.id %}
                        <tr id="block_{{ loop.index }}">
                            <td>
                                <input type="number" id="cat_id_{{ loop.index }}" name="catId[]" value="{{ popularShopGroup.cat_id }}">
                            </td>
                            <td>
                                <input type="text" id="shop_id_{{ loop.index }}" name="shopId[]" value="{{ popularShopGroup.shop_id }}">
                            </td>
                            <td>
                                <input type="hidden" id="sort_{{ loop.index }}" name="sort[{{ loop.index }}]" value="{{ sort }}">

                                <button id="up_{{ loop.index }}"
                                        onclick="upPosition({{ loop.index }}); return false;"
                                        title="Поднять на 1 позицию"
                                        {% if loop.index == 1 %}disabled{% endif %}>
                                    Up
                                </button>


                                <button id="down_{{ loop.index }}"
                                        onclick="downPosition({{ loop.index }}); return false;"
                                        title="Опустить на 1 позицию"
                                        {% if loop.index == popularShopGroups|length %}disabled{% endif %}>
                                    Down
                                </button>

                                <button id="del_{{ loop.index }}" onclick="delCat({{ loop.index }}); return false;" title="Удалить">
                                    Del
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
                <input type="hidden" name="groupId" value="0">
                <button type="submit" class="btn btn-primary">Сохранить все изменения</button>
            </form>













        </div>
    </div>




{% endblock%}

{% block javascripts %}
    <script>
        var countPositon = {{ popularShopGroups|length }};
        var val1, val2, val3, val4, val5, val6;
        function upPosition(position) {
            $('#block_' + position).hide(700);
            $('#block_' + (position - 1)).hide(700, function() {
                val1 = $('#cat_id_' + position).attr('value');
                val3 = $('#shop_id_' + position).attr('value');
                val5 = $('#sort_' + position).attr('value');

                val2 = $('#cat_id_' + (position - 1)).attr('value');
                val4 = $('#shop_id_' + (position - 1)).attr('value');
                val6 = $('#sort_' + (position - 1)).attr('value');

                $('#cat_id_' + position).attr('value', val2);
                $('#shop_id_' + position).attr('value', val4);
                $('#sort_' + position).attr('value', val6);

                $('#cat_id_' + (position - 1)).attr('value', val1);
                $('#shop_id_' + (position - 1)).attr('value', val3);
                $('#sort_' + (position - 1)).attr('value', val5);

                $('#block_' + position).show(400);
                $('#block_' + (position - 1)).show(400);
                console.log('Position change ' + position + '<-->' + (position - 1));
            });
        }

        function downPosition(position) {
            $('#block_' + position).hide(700);
            $('#block_' + (position + 1)).hide(700, function() {
                val1 = $('#cat_id_' + position).attr('value');
                val3 = $('#shop_id_' + position).attr('value');
                val5 = $('#sort_' + position).attr('value');

                val2 = $('#cat_id_' + (position + 1)).attr('value');
                val4 = $('#shop_id_' + (position + 1)).attr('value');
                val6 = $('#sort_' + (position + 1)).attr('value');

                $('#cat_id_' + position).attr('value', val2);
                $('#shop_id_' + position).attr('value', val4);
                $('#sort_' + position).attr('value', val6);

                $('#cat_id_' + (position + 1)).attr('value', val1);
                $('#shop_id_' + (position + 1)).attr('value', val3);
                $('#sort_' + (position + 1)).attr('value', val5);

                $('#block_' + position).show(400);
                $('#block_' + (position + 1)).show(400);
                console.log('Position change ' + position + '<-->' + (position + 1));
            });
        }

        function delCat(item) {

            //$("#del_3").click(function() {
                console.log('OK' + item);
            //});
        }
    </script>
{% endblock%}